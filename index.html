<!DOCTYPE html>
<html>
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4e73df">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Task Manager Pro</title>

<style>
:root {
  --bg: #f4f6f9;
  --card: white;
  --text: #333;
  --primary: #4e73df;
}

.dark {
  --bg: #121212;
  --card: #1e1e1e;
  --text: #ffffff;
  --primary: #00c896;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  background: var(--primary);
  color: white;
  padding: 15px;
  text-align: center;
  font-size: 20px;
}

.container {
  max-width: 500px;
  margin: auto;
  padding: 15px;
}

.card {
  background: var(--card);
  padding: 15px;
  border-radius: 15px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  margin-bottom: 15px;
}

input, button {
  padding: 10px;
  margin: 5px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  width: 100%;
}

button {
  background: var(--primary);
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  opacity: 0.9;
}

.task {
  padding: 10px;
  border-bottom: 1px solid #ddd;
}

.task.completed {
  text-decoration: line-through;
  opacity: 0.6;
}

.actions button {
  width: auto;
  margin-right: 5px;
  padding: 5px 8px;
  font-size: 12px;
}

.toggle {
  text-align: right;
  margin: 10px;
  cursor: pointer;
}
</style>
</head>

<body>

<header>üìÖ Daily Task Manager Pro</header>

<div class="toggle" onclick="toggleDarkMode()">üåô Toggle Dark Mode</div>

<div class="container">

<div class="card">
<h3 id="datetime"></h3>
<input type="text" id="taskName" placeholder="Enter task">
<input type="time" id="taskTime">
<button onclick="addTask()">Add Task</button>
</div>

<div class="card">
<h3>Tasks</h3>
<div id="taskList"></div>
</div>

<div class="card">
<h3>üìä Completed Tasks</h3>
<div id="completedList"></div>
</div>

</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

// üîî Simple Beep Sound
function playSound() {
  const audio = new Audio("https://www.soundjay.com/buttons/sounds/beep-07.mp3");
  audio.play();
}

// Live Date & Time
function updateDateTime() {
  const now = new Date();
  document.getElementById("datetime").innerHTML =
    now.toLocaleDateString() + " | " + now.toLocaleTimeString();
}
setInterval(updateDateTime, 1000);
updateDateTime();

// Notification Permission
if ("Notification" in window) {
  Notification.requestPermission();
}

function saveTasks() {
  localStorage.setItem("tasks", JSON.stringify(tasks));
}

function addTask() {
  const name = document.getElementById("taskName").value;
  const time = document.getElementById("taskTime").value;

  if (!name || !time) {
    alert("Enter task and time");
    return;
  }

  tasks.push({
    id: Date.now(),
    name,
    time,
    completed: false,
    notified30: false,
    notified10: false,
    notified5: false
  });

  saveTasks();
  displayTasks();
  document.getElementById("taskName").value = "";
}

function deleteTask(id) {
  tasks = tasks.filter(task => task.id !== id);
  saveTasks();
  displayTasks();
}

function completeTask(id) {
  tasks = tasks.map(task => {
    if (task.id === id) task.completed = true;
    return task;
  });
  saveTasks();
  displayTasks();
}

function displayTasks() {
  const list = document.getElementById("taskList");
  const completedList = document.getElementById("completedList");
  list.innerHTML = "";
  completedList.innerHTML = "";

  tasks.forEach(task => {
    const div = document.createElement("div");
    div.className = "task";
    if (task.completed) div.classList.add("completed");

    div.innerHTML = `
      <strong>${task.name}</strong><br>
      ‚è∞ ${task.time}
      <div class="actions">
        ${!task.completed ? `<button onclick="completeTask(${task.id})">‚úî Complete</button>` : ""}
        <button onclick="deleteTask(${task.id})">üóë Delete</button>
      </div>
    `;

    if (task.completed)
      completedList.appendChild(div);
    else
      list.appendChild(div);
  });
}

// Notification Checker
setInterval(() => {
  const now = new Date();
  const currentMinutes = now.getHours() * 60 + now.getMinutes();

  tasks.forEach(task => {
    if (task.completed) return;

    const [h, m] = task.time.split(":");
    const taskMinutes = parseInt(h) * 60 + parseInt(m);
    const diff = taskMinutes - currentMinutes;

    if (diff === 30 && !task.notified30) {
      notify(task.name, "30 minutes remaining!");
      task.notified30 = true;
    }

    if (diff === 10 && !task.notified10) {
      notify(task.name, "10 minutes remaining!");
      task.notified10 = true;
    }

    if (diff === 5 && !task.notified5) {
      notify(task.name, "5 minutes remaining!");
      task.notified5 = true;
    }
  });

  saveTasks();
}, 60000);

function notify(name, message) {
  playSound();
  if (Notification.permission === "granted") {
    new Notification("Task Reminder", {
      body: name + " - " + message
    });
  }
}

function toggleDarkMode() {
  document.body.classList.toggle("dark");
}

displayTasks();
</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
